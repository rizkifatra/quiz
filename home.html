<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text & Image Comparison</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        body {
            background: #f8fafc;
            min-height: 100vh;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }

        .hero-section {
            background: var(--primary-gradient);
            padding: 7rem 0 12rem;
            position: relative;
            margin-bottom: -6rem;
        }

        .hero-section::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 150px;
            background: linear-gradient(to bottom, transparent, #f8fafc);
        }

        .card {
            background: var(--card-bg);
            border: none;
            border-radius: 20px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(4px);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .feature-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 24px;
        }

        .btn-primary {
            background: var(--primary-gradient);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 10px;
        }

        .camera-wrapper {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            border: 2px dashed #e2e8f0;
        }

        #camera,
        #snapshot {
            border-radius: 12px;
            max-height: 400px;
            object-fit: cover;
            width: 100%;
        }

        .form-control {
            border-radius: 10px;
            padding: 0.8rem;
            border: 2px solid #e2e8f0;
        }

        .form-control:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .alert {
            border-radius: 12px;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .hero-section {
                padding: 5rem 0 8rem;
            }
        }

        .gradient-text {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .navbar-brand i {
            font-size: 1.25rem;
            transform: translateY(-1px);
        }

        .navbar-brand i.fa-microscope {
            transform: rotate(-15deg);
        }

        .navbar-brand i.fa-camera {
            transform: rotate(15deg);
        }

        .btn-gradient {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            color: white;
        }

        .btn-gradient:active {
            transform: translateY(0);
        }

        .btn-gradient i {
            transition: transform 0.3s ease;
        }

        .btn-gradient:hover i {
            transform: scale(1.1);
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-microscope me-2 text-primary"></i>
                <i class="fas fa-camera me-2 text-info"></i>
                <span class="gradient-text">Rizki Fatra 290911</span>
            </a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section text-center text-white">
        <div class="container">
            <h1 class="display-4 fw-bold mb-4">Transform Images into Text</h1>
            <p class="lead mb-0">Harness the power of AI for accurate text comparison and image recognition</p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container position-relative">
        <!-- Features -->
        <div class="row mb-5 g-4">
            <div class="col-md-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <h4>Capture Image</h4>
                    <p class="text-muted mb-0">Take or upload photos for instant text extraction</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-text-height"></i>
                    </div>
                    <h4>Extract Text</h4>
                    <p class="text-muted mb-0">Convert images to text with high accuracy</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <h4>Compare Results</h4>
                    <p class="text-muted mb-0">Analyze text similarity instantly</p>
                </div>
            </div>
        </div>

        <!-- Image Comparison Tool -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0">Image Comparison</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- First Image Section -->
                    <div class="col-md-6 mb-3">
                        <div class="camera-wrapper">
                            <h6 class="mb-3">First Image</h6>
                            <video id="camera1" class="w-100 mb-2" style="display: none;"></video>
                            <canvas id="canvas1" style="display: none;"></canvas>
                            <img id="snapshot1" class="w-100 mb-2" style="display: none;">

                            <div class="d-flex gap-2 mb-3">
                                <button class="btn btn-primary" id="startCamera1">
                                    <i class="fas fa-camera me-2"></i>Start Camera
                                </button>
                                <button class="btn btn-success d-none" id="captureBtn1">
                                    <i class="fas fa-camera-retro me-2"></i>Capture
                                </button>
                                <button class="btn btn-secondary d-none" id="retakeBtn1">
                                    <i class="fas fa-redo me-2"></i>Retake
                                </button>
                            </div>

                            <div class="mt-3">
                                <p class="text-muted">Or upload an image:</p>
                                <div class="input-group">
                                    <input type="file" class="form-control" id="imageUpload1" accept="image/*">
                                    <button class="btn btn-outline-primary" type="button" id="uploadBtn1">
                                        <i class="fas fa-upload me-2"></i>Upload
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Second Image Section -->
                    <div class="col-md-6 mb-3">
                        <div class="camera-wrapper">
                            <h6 class="mb-3">Second Image</h6>
                            <video id="camera2" class="w-100 mb-2" style="display: none;"></video>
                            <canvas id="canvas2" style="display: none;"></canvas>
                            <img id="snapshot2" class="w-100 mb-2" style="display: none;">

                            <div class="d-flex gap-2 mb-3">
                                <button class="btn btn-primary" id="startCamera2">
                                    <i class="fas fa-camera me-2"></i>Start Camera
                                </button>
                                <button class="btn btn-success d-none" id="captureBtn2">
                                    <i class="fas fa-camera-retro me-2"></i>Capture
                                </button>
                                <button class="btn btn-secondary d-none" id="retakeBtn2">
                                    <i class="fas fa-redo me-2"></i>Retake
                                </button>
                            </div>

                            <div class="mt-3">
                                <p class="text-muted">Or upload an image:</p>
                                <div class="input-group">
                                    <input type="file" class="form-control" id="imageUpload2" accept="image/*">
                                    <button class="btn btn-outline-primary" type="button" id="uploadBtn2">
                                        <i class="fas fa-upload me-2"></i>Upload
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Button and Result -->
                <div class="text-center mt-4">
                    <button class="btn btn-primary btn-lg" id="compareImagesBtn" disabled>
                        <i class="fas fa-sync-alt me-2"></i>Compare Images
                    </button>
                    <button class="btn btn-gradient btn-lg ms-2" id="viewResultsBtn">
                        <i class="fas fa-chart-line me-2"></i>View Results
                    </button>
                    <div id="imageComparisonResult" class="mt-3"></div>
                </div>


            </div>

        </div>
        <!-- Results Modal -->
        <div class="modal fade" id="resultsModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Comparison Results History</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h6 class="card-title">Total Comparisons</h6>
                                        <p class="h3" id="totalComparisons">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h6 class="card-title">Average Score</h6>
                                        <p class="h3" id="averageScore">0%</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h6 class="card-title">Highest Score</h6>
                                        <p class="h3" id="highestScore">0%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <canvas id="statisticsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Chart.js before your other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Modal initialization (keep only this one)
            const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
            const viewResultsBtn = document.getElementById('viewResultsBtn');

            // Add click event listener for the View Results button
            viewResultsBtn.addEventListener('click', () => {
                loadStatistics();
                resultsModal.show();
            });

            // Initialize elements for first image
            const camera1 = document.getElementById('camera1');
            const canvas1 = document.getElementById('canvas1');
            const snapshot1 = document.getElementById('snapshot1');
            const startButton1 = document.getElementById('startCamera1');
            const captureButton1 = document.getElementById('captureBtn1');
            const retakeButton1 = document.getElementById('retakeBtn1');
            const imageUpload1 = document.getElementById('imageUpload1');
            const uploadBtn1 = document.getElementById('uploadBtn1');

            // Initialize elements for second image
            const camera2 = document.getElementById('camera2');
            const canvas2 = document.getElementById('canvas2');
            const snapshot2 = document.getElementById('snapshot2');
            const startButton2 = document.getElementById('startCamera2');
            const captureButton2 = document.getElementById('captureBtn2');
            const retakeButton2 = document.getElementById('retakeBtn2');
            const imageUpload2 = document.getElementById('imageUpload2');
            const uploadBtn2 = document.getElementById('uploadBtn2');

            // Compare button
            const compareButton = document.getElementById('compareImagesBtn');

            let stream1 = null;
            let stream2 = null;

            // Camera handlers for first image
            startButton1.addEventListener('click', async () => {
                try {
                    if (stream1) {
                        stream1.getTracks().forEach(track => track.stop());
                    }
                    // Use default camera settings
                    stream1 = await navigator.mediaDevices.getUserMedia({ video: true });
                    camera1.srcObject = stream1;
                    camera1.style.display = 'block';
                    await camera1.play();
                    startButton1.classList.add('d-none');
                    captureButton1.classList.remove('d-none');
                } catch (err) {
                    console.error('Camera 1 error:', err);
                    alert('Could not access camera 1');
                }
            });

            startButton2.addEventListener('click', async () => {
                try {
                    if (stream2) {
                        stream2.getTracks().forEach(track => track.stop());
                    }
                    // Use default camera settings
                    stream2 = await navigator.mediaDevices.getUserMedia({ video: true });
                    camera2.srcObject = stream2;
                    camera2.style.display = 'block';
                    await camera2.play();
                    startButton2.classList.add('d-none');
                    captureButton2.classList.remove('d-none');
                } catch (err) {
                    console.error('Camera 2 error:', err);
                    alert('Could not access camera 2');
                }
            });

            // Simplify capture handlers to default behavior
            captureButton1.addEventListener('click', () => {
                canvas1.width = camera1.videoWidth;
                canvas1.height = camera1.videoHeight;
                canvas1.getContext('2d').drawImage(camera1, 0, 0);
                snapshot1.src = canvas1.toDataURL('image/jpeg');
                camera1.style.display = 'none';
                snapshot1.style.display = 'block';
                captureButton1.classList.add('d-none');
                retakeButton1.classList.remove('d-none');
                checkEnableCompare();
            });

            captureButton2.addEventListener('click', () => {
                canvas2.width = camera2.videoWidth;
                canvas2.height = camera2.videoHeight;
                canvas2.getContext('2d').drawImage(camera2, 0, 0);
                snapshot2.src = canvas2.toDataURL('image/jpeg');
                camera2.style.display = 'none';
                snapshot2.style.display = 'block';
                captureButton2.classList.add('d-none');
                retakeButton2.classList.remove('d-none');
                checkEnableCompare();
            });

            // Upload handlers
            uploadBtn1.addEventListener('click', () => {
                const file = imageUpload1.files[0];
                handleImageUpload(file, snapshot1, camera1);
            });

            uploadBtn2.addEventListener('click', () => {
                const file = imageUpload2.files[0];
                handleImageUpload(file, snapshot2, camera2);
            });

            function handleImageUpload(file, snapshotElement, cameraElement) {
                if (!file) {
                    alert('Please select an image file');
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    alert('Please select a valid image file');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    snapshotElement.src = e.target.result;
                    snapshotElement.style.display = 'block';
                    cameraElement.style.display = 'none';
                    checkEnableCompare();
                };
                reader.readAsDataURL(file);
            }

            function checkEnableCompare() {
                const hasImage1 = snapshot1.style.display === 'block';
                const hasImage2 = snapshot2.style.display === 'block';
                compareButton.disabled = !(hasImage1 && hasImage2);
            }

            // Compare button handler
            compareButton.addEventListener('click', async () => {
                const result = document.getElementById('imageComparisonResult');

                compareButton.disabled = true;
                result.innerHTML = `
            <div class="alert alert-info">
                <span class="spinner-border spinner-border-sm me-2"></span>
                Comparing images...
            </div>`;

                try {
                    const response = await fetch('compare-proxy.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            image1: snapshot1.src,
                            image2: snapshot2.src
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    if (!data.success) {
                        throw new Error(data.error || 'Failed to compare images');
                    }

                    result.innerHTML = `
                <div class="alert ${data.similarity >= 0.8 ? 'alert-success' : 'alert-warning'}">
                    <h5 class="alert-heading">Image Comparison Result</h5>
                    <p class="mb-0">Similarity Score: ${(data.similarity * 100).toFixed(2)}%</p>
                    ${data.text1 ? `<p class="mb-0">Text 1: ${data.text1}</p>` : ''}
                    ${data.text2 ? `<p class="mb-0">Text 2: ${data.text2}</p>` : ''}
                </div>`;
                } catch (error) {
                    result.innerHTML = `
                <div class="alert alert-danger">
                    ${error.message}
                </div>`;
                } finally {
                    compareButton.disabled = false;
                }
            });

            // Cleanup function
            window.addEventListener('beforeunload', () => {
                if (stream1) {
                    stream1.getTracks().forEach(track => track.stop());
                }
                if (stream2) {
                    stream2.getTracks().forEach(track => track.stop());
                }
            });

            let statisticsChart = null;

            async function loadStatistics() {
                try {
                    const response = await fetch('get_statistics.php');
                    const data = await response.json();

                    if (!data.success) {
                        throw new Error(data.error);
                    }

                    updateStatisticsDisplay(data.statistics);
                    createStatisticsChart(data.history);
                } catch (error) {
                    console.error('Failed to load statistics:', error);
                }
            }

            function updateStatisticsDisplay(stats) {
                document.getElementById('totalComparisons').textContent = stats.total_comparisons;
                document.getElementById('averageScore').textContent = `${(stats.average_score * 100).toFixed(1)}%`;
                document.getElementById('highestScore').textContent = `${(stats.highest_score * 100).toFixed(1)}%`;
            }

            function createStatisticsChart(history) {
                const ctx = document.getElementById('statisticsChart').getContext('2d');

                if (statisticsChart) {
                    statisticsChart.destroy();
                }

                statisticsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: history.map(item => new Date(item.timestamp).toLocaleDateString()),
                        datasets: [{
                            label: 'Similarity Score (%)',
                            data: history.map(item => item.similarity_score * 100),
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Comparison History'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Similarity Score (%)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Date'
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>